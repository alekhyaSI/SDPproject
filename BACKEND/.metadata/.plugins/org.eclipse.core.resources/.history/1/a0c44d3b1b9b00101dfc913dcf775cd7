package com.tutorfinder.controller;

import com.tutorfinder.dto.StudentProfileDTO;
import com.tutorfinder.dto.StudentTutorMappingDTO;
import com.tutorfinder.dto.TutorProfileDTO;
import com.tutorfinder.service.AdminMappingService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/admin")
@CrossOrigin("*")
public class AdminMappingController {

    @Autowired
    private AdminMappingService adminMappingService;

    // Fetch all students
    @GetMapping("/students")
    public ResponseEntity<List<StudentProfileDTO>> getAllStudents() {
        return ResponseEntity.ok(adminMappingService.getAllStudents());
    }

    // Get tutors matching student's availability
    @GetMapping("/students/{studentId}/matching-tutors")
    public ResponseEntity<List<TutorProfileDTO>> getMatchingTutors(@PathVariable Long studentId) {
        return ResponseEntity.ok(adminMappingService.getMatchingTutorsForStudent(studentId));
    }

    // Assign student to tutor
    @PostMapping("/assign")
    public ResponseEntity<StudentTutorMappingDTO> assignStudentToTutor(
            @RequestParam Long studentId,
            @RequestParam Long tutorId,
            @RequestParam String subject,
            @RequestParam String availability) {

        return ResponseEntity.ok(adminMappingService.mapStudentToTutor(studentId, tutorId, subject, availability));
    }

    // Get all mappings
    @GetMapping("/mappings")
    public ResponseEntity<List<StudentTutorMappingDTO>> getAllMappings() {
        return ResponseEntity.ok(adminMappingService.getAllMappings());
    }

    // Delete mapping
    @DeleteMapping("/mappings/{mappingId}")
    public ResponseEntity<String> deleteMapping(@PathVariable Long mappingId) {
        adminMappingService.deleteMapping(mappingId);
        return ResponseEntity.ok("Mapping deleted successfully");
    }
}